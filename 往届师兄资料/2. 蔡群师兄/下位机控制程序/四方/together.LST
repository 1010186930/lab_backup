C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE TOGETHER
OBJECT MODULE PLACED IN together.OBJ
COMPILER INVOKED BY: F:\c51 keil\C51\BIN\C51.EXE together.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          
   2          #include<reg52.h>
   3          #include<intrins.h>             
   4          bit cmdArrived = 0; 
   5          /*********************LED*********************/  
   6          unsigned char cmdIndex,start1,start2,start3,start4,start5;//定义芯片锁存唯一缓存数据符号                                              
             -            //其1~5分别对应位移缓存器1~3与锁存器1~2
   7          unsigned char ST;
   8          sbit LE2=P3^7;//定义单片机数据引脚 573片2锁存引脚
   9          sbit LE1=P3^5;    //573片1锁存引脚
  10          sbit OE31=P3^4;   //573片1使能引脚
  11          sbit OE32=P3^6;   //573片2使能引脚
  12          sbit SCL1=P2^0;  //595第11引脚
  13          sbit SCL2=P2^1;  //595第12引脚
  14          sbit SDA1=P2^2;  //595第14引脚
  15          sbit OE=P2^5;    //595片1使能引脚
  16          sbit OE1=P2^4;   //595片2使能引脚
  17          sbit OE2=P2^3;   //595片3使能引脚
  18          unsigned char zkb,zkb2,zkb3,zkb4,zkb5;// 定义zkb占空比
  19          unsigned char t,t2,t3,t4,t5;//定灰度扫描时间线
  20          unsigned char k,r1,r2,r3,r4,r5; //定义位移缓存数据写入标志位
  21          unsigned char ce1,ce2,ce3,ce4;     //定义595片1数据写入变量
  22          unsigned char c2e1,c2e2,c2e3,c2e4; //定义595片2数据写入变量
  23          unsigned char c3e1,c3e2,c3e3,c3e4; //定义595片3数据写入变量
  24          unsigned char c4e1,c4e2,c4e3,c4e4; //定义573片1数据写入变量
  25          unsigned char c5e1,c5e2,c5e3,c5e4; //定义573片2数据写入变量
  26          /*********************动点*********************/
  27          unsigned char pin1,pin2,pin3,pin4,pin5,pin6;
  28          unsigned char ST;
  29          sbit SCL1d=P2^6;         //595第11引脚
  30          sbit SCL2d=P2^7;         //595第12引脚
  31          sbit SDA1d=P3^3;         //595第14引脚
  32          sbit OEd=P3^2;   //595片1使能引脚 
  33          /*sbit SCL1d=P0^7;       //595第11引脚
  34          sbit SCL2d=P0^6;         //595第12引脚
  35          sbit SDA1d=P0^5;         //595第14引脚
  36          sbit OEd=P0^4;   //595片1使能引脚 */
  37          unsigned char d1,d2,d3,d4,d5,d6; //定义位移缓存数据写入标志位
  38          unsigned char dz1,dz2,dz3,dz4;     //定义595片1数据写入变量
  39          unsigned char d2z1,d2z2,d2z3,d2z4; //定义595片2数据写入变量
  40          unsigned char d3z1,d3z2,d3z3,d3z4; //定义595片3数据写入变量
  41          unsigned char d4z1,d4z2,d4z3,d4z4; //定义573片1数据写入变量
  42          unsigned char d5z1,d5z2,d5z3,d5z4; //定义573片2数据写入变量
  43          unsigned char d6z1,d6z2,d6z3,d6z4; //定义573片2数据写入变量
  44          void init()  //初始化函数
  45            {
  46   1           TMOD|=0X01;//初始化定时器
  47   1               TH0=(65536-500)/256;    //初值配置
  48   1               TL0=(65536-500)%256;
  49   1               EA=1;                                   //开总中断
  50   1               ET0=1;                                  //定时/计数器T0中断允许
  51   1               TR0=1;                                  
  52   1        }
  53          void Delay10ms(unsigned int c)   //延时函数 误差 0us
  54          {
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 2   

  55   1          unsigned char a, b;
  56   1          for (;c>0;c--)
  57   1              {
  58   2                      for (b=38;b>0;b--)
  59   2                      {
  60   3                              for (a=130;a>0;a--);
  61   3                      }
  62   2                 
  63   2              }
  64   1              
  65   1      }       
  66          void UsartConfiguration()
  67          {
  68   1              SCON=0X50;                      //设置为工作方式1
  69   1              TMOD|=0X20;                     //设置计数器工作方式2
  70   1              PCON=0X00;                      //波特率加倍 0x80波特率加倍
  71   1              TH1=0Xfd;                               //计数器初始值设置，注意波特率是9600的
  72   1              TL1=0Xfd;
  73   1              ES=1;                                           //打开接收中断
  74   1              EA=1;                                           //打开总中断
  75   1              TR1=1;                                          //打开计数器
  76   1              IP=0X10;
  77   1              PS=1;
  78   1      
  79   1       }
  80          
  81          /*********************LED*********************/ 
  82           void in(unsigned char Data)//位移缓存器数据输入函数
  83            {
  84   1      unsigned char i;
  85   1            for(i = 0; i < 8; i++)  //循环8次刚好移完8次
  86   1          {
  87   2             SCL1 = 0;
  88   2                 SCL2 = 0;        //移位寄存器控制端引脚置低    
  89   2             _nop_();
  90   2             if((Data & 0x80)== 0x80)
  91   2                  SDA1 =1;
  92   2             else
  93   2                 SDA1 =0;
  94   2       
  95   2             Data <<= 1;//将数据次高位移动到最高位
  96   2       
  97   2             SCL1 = 1;//在置为高，产生移位时钟上升沿，上升沿时数据寄存器的数据位移位
  98   2             _nop_();
  99   2                 _nop_();
 100   2                 SCL1 = 0;
 101   2           }
 102   1        }
 103           
 104          
 105          
 106          void out(void)//位移缓存器数据输出函数
 107            {
 108   1            SCL2 = 1;//先将存储寄存器引脚拉高
 109   1           _nop_();
 110   1               _nop_();
 111   1            SCL2 = 0;//再置高，产生移位时钟上升沿，上升沿时移位寄存器的数据进入数据存储寄存器，更新显示数据
 112   1        }
 113          void Usart() interrupt 4
 114          {
 115   1          if (RI) //接收到字节
 116   1          {                                                                                                                                              
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 3   

 117   2                      cmdIndex = SBUF;  //数据接收（SBUF数据接收寄存器）
 118   2                      ce3 = SBUF;               //595片1数据接收
 119   2                      c2e3 = SBUF;      //595片2数据接收
 120   2                      c3e3 = SBUF;      //595片3数据接收
 121   2                      c4e3 = SBUF;      //573片1数据接收
 122   2                      c5e3 = SBUF;      //573片2数据接收
 123   2                  dz3 = SBUF;           //动点595片1数据接收
 124   2                      d2z3 = SBUF;      //动点595片2数据接收
 125   2                      d3z3 = SBUF;      //动点595片3数据接收
 126   2                      d4z3 = SBUF;      //动点573片1数据接收
 127   2                      d5z3 = SBUF;      //动点573片2数据接收
 128   2                      d6z3 = SBUF;      //动点573片2数据接收
 129   2                      RI = 0;  //清零接收中断标志位
 130   2                      SBUF = cmdIndex;//将接收到的数据放入到发送寄存器
 131   2                      cmdArrived = 1;  
 132   2          }
 133   1          if (TI)//字节发送完
 134   1          {                                                                                                    
 135   2              TI = 0;//清零发送中断标志位
 136   2          }
 137   1      }
 138            void ind(unsigned char Data)//位移缓存器数据输入函数
 139            {
 140   1      unsigned char i;
 141   1            for(i = 0; i < 8; i++)  //循环8次刚好移完8次
 142   1          {
 143   2             SCL1d = 0;
 144   2                 SCL2d = 0;        //移位寄存器控制端引脚置低    
 145   2             _nop_();
 146   2             if((Data & 0x80)== 0x80)
 147   2                  SDA1d =1;
 148   2             else
 149   2                 SDA1d =0;
 150   2       
 151   2             Data <<= 1;//将数据次高位移动到最高位
 152   2       
 153   2             SCL1d = 1;//在置为高，产生移位时钟上升沿，上升沿时数据寄存器的数据位移位
 154   2             _nop_();
 155   2                 _nop_();
 156   2                 SCL1d = 0;
 157   2           }
 158   1        }
 159           
 160          
 161          
 162          void outd(void)//位移缓存器数据输出函数
 163            {
 164   1            SCL2d = 1;//先将存储寄存器引脚拉高
 165   1           _nop_();
 166   1               _nop_();
 167   1            SCL2d = 0;//再置高，产生移位时钟上升沿，上升沿时移位寄存器的数据进入数据存储寄存器，更新显示数据
 168   1        }
 169          void LEDinit() //LED初始化函数
 170          {
 171   1          zkb=10; //初始9片1化占空比
 172   1              zkb2=10;//初始9片2化占空比
 173   1              zkb3=10;//初始9片3化占空比
 174   1              zkb4=10;//初始3片1化占空比
 175   1              zkb5=10;//初始3片2化占空比                      
 176   1              ST=0;
 177   1          OE=0;//使能端清零
 178   1          OE1=0;
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 4   

 179   1          OE2=0;
 180   1          OE31=0;
 181   1          OE32=0;
 182   1          IP=0X10;
 183   1              r1=0;//数据写入标志位清零
 184   1              r2=0;
 185   1              r3=0;
 186   1              ce2=0x00;        //写入变量清零
 187   1              ce4=0x00;
 188   1              c2e2=0x00;
 189   1              c2e4=0x00;
 190   1              c3e2=0x00;
 191   1              c3e4=0x00;
 192   1              c5e4=0xff;
 193   1              c4e4=0xff;
 194   1      }
 195          void PINinit()  //动点初始化函数
 196          {
 197   1              d1=0;//数据写入标志位清零
 198   1              d2=0;
 199   1              d3=0;    //写入变量清零
 200   1          d4=0;
 201   1          d5=0;
 202   1          d6=0;
 203   1              dz4=0xff;
 204   1              d2z4=0xff;
 205   1              d3z4=0xff;
 206   1              d4z4=0xff;
 207   1              d5z4=0xff;
 208   1              d6z4=0xff;      
 209   1      }
 210            void sleep()
 211          {
 212   1        OEd=0;
 213   1        ind(0xff);
 214   1        ind(0xff);
 215   1        ind(0xff);
 216   1        ind(0xff);
 217   1        ind(0xff);
 218   1        ind(0xff);
 219   1        outd();
 220   1      }
 221          
 222          
 223          void clear()
 224          {
 225   1          OEd=0;
 226   1          ind(0xff);
 227   1              ind(0xff);
 228   1          ind(0xff);
 229   1              ind(0xff);
 230   1          ind(0xff);
 231   1          ind(0xaa);
 232   1          outd();
 233   1          Delay10ms(10);
 234   1              ind(0xff);
 235   1              ind(0xff);
 236   1          ind(0xff);
 237   1          ind(0xff);
 238   1          ind(0xaa);
 239   1          ind(0xff);
 240   1          outd();
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 5   

 241   1              Delay10ms(10);
 242   1              ind(0xff);
 243   1              ind(0xff);
 244   1          ind(0xff);
 245   1              ind(0xaa);
 246   1          ind(0xff);
 247   1          ind(0xff);
 248   1          outd();
 249   1          Delay10ms(10);
 250   1              ind(0xff);
 251   1              ind(0xff);
 252   1          ind(0xaa);
 253   1              ind(0xff);
 254   1          ind(0xff);
 255   1          ind(0xff);
 256   1          outd();
 257   1          Delay10ms(10);
 258   1          ind(0xff);
 259   1              ind(0xaa);
 260   1          ind(0xff);
 261   1              ind(0xff);
 262   1          ind(0xff);
 263   1          ind(0xff);
 264   1          outd();
 265   1          Delay10ms(10);
 266   1              ind(0xaa);
 267   1              ind(0xff);
 268   1          ind(0xff);
 269   1              ind(0xff);
 270   1          ind(0xff);
 271   1          ind(0xff);
 272   1          outd();
 273   1          Delay10ms(10);
 274   1              sleep();
 275   1      }       
 276          void main()
 277          {       
 278   1              k=0;//赋值595输入退出参数
 279   1              UsartConfiguration();//初始化计数器
 280   1              init();//初始化定时器
 281   1              LEDinit();
 282   1              PINinit();
 283   1              clear();
 284   1          Delay10ms(10);
 285   1              sleep();
 286   1              Delay10ms(10);
 287   1              while(1)
 288   1               {  
 289   2                if(cmdArrived)//进入中断，接受完数据且使得cmdIndex = SBUF后才执行
 290   2                      {
 291   3                        cmdArrived = 0;       
 292   3                              if(cmdIndex==0x38)//595区域一亮度减少
 293   3                            {
 294   4                                  k=0;
 295   4                                   if(k==0)
 296   4                                     {
 297   5                                       k++;
 298   5                                       if(zkb>0)
 299   5                                             {
 300   6                                               zkb--;
 301   6                                             }
 302   5                                      }        
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 6   

 303   4                             }
 304   3              else if(cmdIndex==0x37)//595区域一亮度增加
 305   3                              {  
 306   4                       k=0;
 307   4                               if(k==0)
 308   4                               {
 309   5                                   if(zkb<9)
 310   5                                      {
 311   6                                         zkb++;
 312   6                                      }
 313   5                                }
 314   4                      
 315   4                              }
 316   3                              
 317   3                      
 318   3                  else if(cmdIndex==0x23)//595区二亮度减少
 319   3                            {
 320   4                                  k=0;
 321   4                                   if(k==0)
 322   4                                     {
 323   5                                       k++;
 324   5                                       if(zkb2>0)
 325   5                                             {
 326   6                                               zkb2--;
 327   6                                             }
 328   5                                      }        
 329   4                             }
 330   3              else if(cmdIndex==0x39)//595区域二亮度增加
 331   3                              {  
 332   4                       k=0;
 333   4                               if(k==0)
 334   4                               {
 335   5                                   if(zkb2<9)
 336   5                                      {
 337   6                                         zkb2++;
 338   6                                      }
 339   5                                }
 340   4                      
 341   4                              }
 342   3                              
 343   3                      else if(cmdIndex==0x25)//595区三亮度减少
 344   3                            {
 345   4                                  k=0;
 346   4                                   if(k==0)
 347   4                                     {
 348   5                                       k++;
 349   5                                       if(zkb3>0)
 350   5                                             {
 351   6                                               zkb3--;
 352   6                                             }
 353   5                                      }        
 354   4                             }
 355   3              else if(cmdIndex==0x3F)//595区域三亮度增加
 356   3                              {  
 357   4                       k=0;
 358   4                               if(k==0)
 359   4                               {
 360   5                                   if(zkb3<9)
 361   5                                      {
 362   6                                         zkb3++;
 363   6                                      }
 364   5                                }
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 7   

 365   4                      
 366   4                              }                                       
 367   3                      else if(cmdIndex==0x2B)//573区域一亮度减少
 368   3                            {
 369   4                                  k=0;
 370   4                                   if(k==0)
 371   4                                     {
 372   5                                       k++;
 373   5                                       if(zkb4>0)
 374   5                                             {
 375   6                                               zkb4--;
 376   6                                             }
 377   5                                      }        
 378   4                             }
 379   3              else if(cmdIndex==0x36)//573区域一亮度增加
 380   3                              {  
 381   4                       k=0;
 382   4                               if(k==0)
 383   4                               {
 384   5                                   if(zkb4<9)
 385   5                                      {
 386   6                                         zkb4++;
 387   6                                      }
 388   5                                }
 389   4                      
 390   4                              }                                       
 391   3                      else if(cmdIndex==0x2E)//573区域二亮度减少
 392   3                            {
 393   4                                  k=0;
 394   4                                   if(k==0)
 395   4                                     {
 396   5                                       k++;
 397   5                                       if(zkb5>0)
 398   5                                             {
 399   6                                               zkb5--;
 400   6                                             }
 401   5                                      }        
 402   4                             }
 403   3              else if(cmdIndex==0x2c)//573区域二亮度增加
 404   3                              {  
 405   4                       k=0;
 406   4                               if(k==0)
 407   4                               {
 408   5                                   if(zkb5<9)
 409   5                                      {
 410   6                                         zkb5++;
 411   6                                      }
 412   5                                }
 413   4                      
 414   4                              }                               
 415   3                      else if(cmdIndex==0x7E)//灯整体亮灭              
 416   3                              {       
 417   4                                      while(1)
 418   4                                   {
 419   5                                         if(cmdIndex==0x26)
 420   5                                 {
 421   6                                                        OE=0;
 422   6                                                        OE1=0;
 423   6                                                        OE2=0;
 424   6                                                        ET0=1; 
 425   6                                                        break;
 426   6                                 } 
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 8   

 427   5                                       OE=1;
 428   5                                                       OE1=1;
 429   5                                                       OE2=1;
 430   5                                                       ET0=0; 
 431   5                                      
 432   5                               }              
 433   4                              }       
 434   3              else if(cmdIndex==0x30)//595区域一送数据
 435   3                  {
 436   4      
 437   4                               ST=1;
 438   4                               start1=0x00;
 439   4                               cmdIndex=0x00;
 440   4                               ce1=0x00;
 441   4                               ce3=0x00;
 442   4                               ce2=0x00;
 443   4      
 444   4                               start2=0x00;
 445   4                               c2e1=0x00;
 446   4                               c2e3=0x00;
 447   4                               c2e2=0x00;
 448   4      
 449   4                               start3=0x00;
 450   4                               c3e1=0x00;
 451   4                               c3e3=0x00;
 452   4                               c3e2=0x00;
 453   4                               while(1&ST)
 454   4                                {
 455   5                                  if(ce3>=0x01&&ce3<=0x08)
 456   5                                      {
 457   6                                       if(ce3==0x01)
 458   6                                       {
 459   7                                       ce1=0x01;
 460   7                                       ce2=ce4|ce1;
 461   7                                       ce4=ce2;
 462   7                                       ce3=0x00;
 463   7                                       }        
 464   6                                       if(ce3==0x02)
 465   6                                       {
 466   7                                       ce1=0x02;
 467   7                                       ce2=ce4|ce1;
 468   7                                       ce4=ce2;
 469   7                                       ce3=0x00;                                                               
 470   7                                       }
 471   6                                       if(ce3==0x03)
 472   6                                       {
 473   7                                       ce1=0x04;
 474   7                                       ce2=ce4|ce1;
 475   7                                       ce4=ce2;
 476   7                                       ce3=0x00;                                                               
 477   7                                       }
 478   6                                       if(ce3==0x04)
 479   6                                       {
 480   7                                       ce1=0x08;
 481   7                                       ce2=ce4|ce1;
 482   7                                       ce4=ce2;
 483   7                                       ce3=0x00;                                                               
 484   7                                       }
 485   6                                       if(ce3==0x05)
 486   6                                       {
 487   7                                       ce1=0x10;
 488   7                                       ce2=ce4|ce1;
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 9   

 489   7                                       ce4=ce2;
 490   7                                       ce3=0x00;                                                               
 491   7                                       }
 492   6                                       if(ce3==0x06)
 493   6                                       {
 494   7                                       ce1=0x20;
 495   7                                       ce2=ce4|ce1;
 496   7                                       ce4=ce2;
 497   7                                       ce3=0x00;                                                               
 498   7                                       }
 499   6                                       if(ce3==0x07)
 500   6                                       {
 501   7                                       ce1=0x40;
 502   7                                       ce2=ce4|ce1;
 503   7                                       ce4=ce2;
 504   7                                       ce3=0x00;                               
 505   7                                       }
 506   6                                       if(ce3==0x08)
 507   6                                       {
 508   7                                       ce1=0x80;
 509   7                                       ce2=ce4|ce1;
 510   7                                       ce4=ce2;
 511   7                                       ce3=0x00;
 512   7                                       }
 513   6                                       }
 514   5                                      if(c2e3>=0x09&&c2e3<=0x16)
 515   5                                      {
 516   6                                      if(c2e3==0x09)
 517   6                                       {
 518   7                                       c2e1=0x01;
 519   7                                       c2e2=c2e4|c2e1;
 520   7                                       c2e4=c2e2;
 521   7                                       c2e3=0x00;
 522   7                                       }        
 523   6                                       if(c2e3==0x10)
 524   6                                       {
 525   7                                       c2e1=0x02;
 526   7                                       c2e2=c2e4|c2e1;
 527   7                                       c2e4=c2e2;
 528   7                                       c2e3=0x00;
 529   7                                       
 530   7                                       
 531   7                                       }
 532   6                                       if(ce3==0x11)
 533   6                                       {
 534   7                                       c2e1=0x04;
 535   7                                       c2e2=c2e4|c2e1;
 536   7                                       c2e4=c2e2;
 537   7                                       ce3=0x00;                                                               
 538   7                                       }
 539   6                                       if(c2e3==0x12)
 540   6                                       {
 541   7                                       c2e1=0x08;
 542   7                                       c2e2=c2e4|c2e1;
 543   7                                       c2e4=c2e2;
 544   7                                       c2e3=0x00;                                                              
 545   7                                       }
 546   6                                       if(c2e3==0x13)
 547   6                                       {c2e1=0x10;
 548   7                                       c2e2=c2e4|c2e1;
 549   7                                       c2e4=c2e2;
 550   7                                       c2e3=0x00;                                                              
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 10  

 551   7                                       }
 552   6                                       if(c2e3==0x14)
 553   6                                       {
 554   7                                       c2e1=0x20;
 555   7                                       c2e2=c2e4|c2e1;
 556   7                                       c2e4=c2e2;
 557   7                                       c2e3=0x00;                                                              
 558   7                                       }
 559   6                                       if(c2e3==0x15)
 560   6                                       {c2e1=0x40;
 561   7                                       c2e2=c2e4|c2e1;
 562   7                                       c2e4=c2e2;
 563   7                                       c2e3=0x00;                                              
 564   7                                       }
 565   6                                       if(c2e3==0x16)
 566   6                                       {
 567   7                                       c2e1=0x80;
 568   7                                       c2e2=c2e4|c2e1;
 569   7                                       c2e4=c2e2;
 570   7                                       ce3=0x00;
 571   7                                       }                               
 572   6                                      }
 573   5                                      if(c3e3>=0x17&&c3e3<=0x19) 
 574   5                                      {
 575   6                                       if(c3e3==0x17)
 576   6                                       {
 577   7                                       c3e1=0x01;
 578   7                                       c3e2=c3e4|c3e1;
 579   7                                       c3e4=c3e2;
 580   7                                       c3e3=0x00;
 581   7                                       }        
 582   6                                       if(c3e3==0x18)
 583   6                                       {
 584   7                                       c3e1=0x02;
 585   7                                       c3e2=c3e4|c3e1;
 586   7                                       c3e4=c3e2;
 587   7                                       c3e3=0x00;                                                              
 588   7                                       }
 589   6                                       if(c3e3==0x19)
 590   6                                       {c3e1=0x04;
 591   7                                       c3e2=c3e4|c3e1;
 592   7                                       c3e4=c3e2;
 593   7                                       c3e3=0x00;                                                              
 594   7                                       }               
 595   6                                      }                                        
 596   5                                       start1=ce2;
 597   5                                       start2=c2e2;
 598   5                                       start3=c3e2; 
 599   5                     if(cmdIndex==0x33)                //
 600   5                                 {
 601   6                                 if(start1!=0x00)r1=1;
 602   6                                 if(start2!=0x00)r2=1;
 603   6                                 if(start3!=0x00)r3=1;
 604   6                                 ST=0;
 605   6                                 break;
 606   6                                 } 
 607   5                                }
 608   4                              }                 
 609   3                  else if(cmdIndex==0x33)     //行区域输入数据点亮
 610   3                  {
 611   4                                if(r1==0)start1=0x00;
 612   4                                if(r2==0)start2=0x00;
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 11  

 613   4                                if(r3==0)start3=0x00;
 614   4                                ST=1;
 615   4                                while(1&ST)
 616   4                                 {
 617   5                      in(start3);
 618   5                                      in(start2);
 619   5                                      in(start1);
 620   5                                      out();
 621   5                                      start1=0x00;
 622   5                                      start2=0x00;
 623   5                                      start3=0x00;
 624   5                                      ce4=0x00;
 625   5                                  c2e4=0x00;
 626   5                                  c3e4=0x00;
 627   5                                      r1=0;
 628   5                                      r2=0;
 629   5                                      r3=0;
 630   5                                      ST=0;
 631   5                                  break;
 632   5                                }
 633   4                              }               
 634   3                       else if(cmdIndex==0x34)        //列区域送数据
 635   3                       {
 636   4                           ST=1;
 637   4                               start4=0xff;
 638   4                               cmdIndex=0x00;
 639   4                               c4e1=0xff;
 640   4                               c4e3=0x00;
 641   4                               c4e2=0xff;
 642   4      
 643   4                               start5=0xff;
 644   4                               c5e1=0xff;
 645   4                               c5e3=0x00;
 646   4                               c5e2=0xff;                      
 647   4      
 648   4                               while(1&ST)
 649   4                                {
 650   5                                 if(c4e3>=0x01&&c4e3<=0x08)
 651   5                                 {
 652   6                      if(c4e3==0x01)
 653   6                                       {c4e1=0xfe;
 654   7                                       c4e2=c4e4&c4e1;
 655   7                                       c4e4=c4e2;
 656   7                                       c4e3=0x00;
 657   7                                       }        
 658   6                                       if(c4e3==0x02)
 659   6                                       {c4e1=0xfd;
 660   7                                       c4e2=c4e4&c4e1;
 661   7                                       c4e4=c4e2;
 662   7                                       c4e3=0x00;
 663   7                                       
 664   7                                       
 665   7                                       }
 666   6                                       if(c4e3==0x03)
 667   6                                       {c4e1=0xfb;
 668   7                                       c4e2=c4e4&c4e1;
 669   7                                       c4e4=c4e2;
 670   7                                       c4e3=0x00;
 671   7                                       
 672   7                                       
 673   7                                       }
 674   6                                       if(c4e3==0x04)
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 12  

 675   6                                       {c4e1=0xf7;
 676   7                                       c4e2=c4e4&c4e1;
 677   7                                       c4e4=c4e2;
 678   7                                       c4e3=0x00;
 679   7                                       
 680   7                                       
 681   7                                       }
 682   6                                       if(c4e3==0x05)
 683   6                                       {c4e1=0xef;
 684   7                                       c4e2=c4e4&c4e1;
 685   7                                       c4e4=c4e2;
 686   7                                       c4e3=0x00;
 687   7                                       
 688   7                                       
 689   7                                       }
 690   6                                       if(c4e3==0x06)
 691   6                                       {c4e1=0xdf;
 692   7                                       c4e2=c4e4&c4e1;
 693   7                                       c4e4=c4e2;
 694   7                                       c4e3=0x00;
 695   7                                       
 696   7                                       
 697   7                                       }
 698   6                                       if(c4e3==0x07)
 699   6                                       {c4e1=0xbf;
 700   7                                       c4e2=c4e4&c4e1;
 701   7                                       c4e4=c4e2;
 702   7                                       c4e3=0x00;
 703   7                       
 704   7                                       
 705   7                                       }
 706   6                                       if(c4e3==0x08)
 707   6                                       {c4e1=0x7f;
 708   7                                       c4e2=c4e4&c4e1;
 709   7                                       c4e4=c4e2;
 710   7                                       c4e3=0x00;
 711   7                                       }
 712   6                                      }       
 713   5                                      if(c5e3>=0x09&&c5e3<=0x12) 
 714   5                                      {
 715   6                                       if(c5e3==0x09)
 716   6                                       {c5e1=0xfe;
 717   7                                       c5e2=c5e4&c5e1;
 718   7                                       c5e4=c5e2;
 719   7                                       c5e3=0x00;
 720   7                                       }        
 721   6                                       if(c5e3==0x10)
 722   6                                       {c5e1=0xfd;
 723   7                                       c5e2=c5e4&c5e1;
 724   7                                       c5e4=c5e2;
 725   7                                       c5e3=0x00;
 726   7                                       
 727   7                                       
 728   7                                       }
 729   6                                       if(c5e3==0x11)
 730   6                                       {c5e1=0xfb;
 731   7                                       c5e2=c5e4&c5e1;
 732   7                                       c5e4=c5e2;
 733   7                                       c5e3=0x00;
 734   7                                       
 735   7                                       
 736   7                                       }
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 13  

 737   6                                       if(c5e3==0x12)
 738   6                                       {c5e1=0xf7;
 739   7                                       c5e2=c5e4&c5e1;
 740   7                                       c5e4=c5e2;
 741   7                                       c5e3=0x00;
 742   7                                       
 743   7                                       
 744   7                                       }
 745   6                                      }                        
 746   5                                       start4=c4e2;
 747   5                                       start5=c5e2;
 748   5                       if(cmdIndex==0x41)
 749   5                                 {
 750   6                                 if(start4!=0xff)r4=1;
 751   6                                 if(start5!=0xff)r5=1;
 752   6                                 ST=0;
 753   6                                 break;
 754   6                                 } 
 755   5                                }     
 756   4                                  
 757   4      
 758   4                       }       
 759   3      
 760   3                      else if(cmdIndex==0x41)         //573点亮  
 761   3                      {
 762   4                    if(r4==0)start4=0xff;
 763   4                                if(r5==0)start5=0xff;
 764   4                                ST=1;
 765   4                                while(1&ST)
 766   4                                 {
 767   5                                       LE2=0; //列区域一
 768   5                                       LE1=1;
 769   5                                       P1 = start4;
 770   5                                       LE1=0;
 771   5      
 772   5                       LE2=1; //列区域二
 773   5                                       LE1=0;
 774   5                                       P1 =start5;
 775   5                                       LE2=0;
 776   5                                       start4=0xff;
 777   5                                   start5=0xff;
 778   5      
 779   5                                   c4e4=0xff;
 780   5                                   c5e4=0xff;
 781   5                                       r4=0;
 782   5                                       r5=0;
 783   5                                       ST=0;
 784   5                                   break;             
 785   5                         }
 786   4      
 787   4                      }
 788   3                 else if(cmdIndex==0x31)//动点选择
 789   3                  {
 790   4                               ST=1;
 791   4                               pin1=0xff;
 792   4                               cmdIndex=0x00;
 793   4                               dz1=0xff;
 794   4                               dz3=0x00;
 795   4                               dz2=0xff;
 796   4      
 797   4                               pin2=0xff;
 798   4                               d2z1=0xff;
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 14  

 799   4                               d2z3=0x00;
 800   4                               d2z2=0xff;
 801   4      
 802   4                               pin3=0xff;
 803   4                               d3z1=0xff;
 804   4                               d3z3=0x00;
 805   4                               d3z2=0xff;
 806   4      
 807   4                               pin4=0xff;
 808   4                               d4z1=0xff;
 809   4                               d4z3=0x00;
 810   4                               d4z2=0xff;
 811   4      
 812   4                               pin5=0xff;
 813   4                               d5z1=0xff;
 814   4                               d5z3=0x00;
 815   4                               d5z2=0xff;
 816   4      
 817   4                               pin6=0xff;
 818   4                               d6z1=0xff;
 819   4                               d6z3=0x00;
 820   4                               d6z2=0xff;
 821   4      
 822   4                               while(1&ST)
 823   4                                {
 824   5                                  if(dz3>=0x01&&dz3<=0x04)  //第一片
 825   5                                      {
 826   6                                       if(dz3==0x01)
 827   6                                       {
 828   7                                       dz1=0xfd;
 829   7                                       dz2=dz4&dz1;
 830   7                                       dz4=dz2;
 831   7                                       dz3=0x00;
 832   7                                       }        
 833   6                                       if(dz3==0x02)
 834   6                                       {
 835   7                                       dz1=0xf7;
 836   7                                       dz2=dz4&dz1;
 837   7                                       dz4=dz2;
 838   7                                       dz3=0x00;                                                               
 839   7                                       }
 840   6                                       if(dz3==0x03)
 841   6                                       {
 842   7                                       dz1=0xdf;
 843   7                                       dz2=dz4&dz1;
 844   7                                       dz4=dz2;
 845   7                                       dz3=0x00;                                                               
 846   7                                       }
 847   6                                       if(dz3==0x04)
 848   6                                       {
 849   7                                       dz1=0x7f;
 850   7                                       dz2=dz4&dz1;
 851   7                                       dz4=dz2;
 852   7                                       dz3=0x00;                                                               
 853   7                                       }
 854   6                                       }
 855   5                                      if(d2z3>=0x05&&d2z3<=0x08)       //第二片
 856   5                                      {
 857   6                                      if(d2z3==0x05)
 858   6                                       {
 859   7                                       d2z1=0xfd;
 860   7                                       d2z2=d2z4&d2z1;
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 15  

 861   7                                       d2z4=d2z2;
 862   7                                       d2z3=0x00;
 863   7                                       }        
 864   6                                       if(d2z3==0x06)
 865   6                                       {
 866   7                                       d2z1=0xf7;
 867   7                                       d2z2=d2z4&d2z1;
 868   7                                       d2z4=d2z2;
 869   7                                       d2z3=0x00;                                              
 870   7                                       }
 871   6                                       if(d2z3==0x07)
 872   6                                       {
 873   7                                       d2z1=0xdf;
 874   7                                       d2z2=d2z4&d2z1;
 875   7                                       d2z4=d2z2;
 876   7                                       d2z3=0x00;                                                              
 877   7                                       }
 878   6                                       if(d2z3==0x08)
 879   6                                       {
 880   7                                       d2z1=0x7f;
 881   7                                       d2z2=d2z4&d2z1;
 882   7                                       d2z4=d2z2;
 883   7                                       d2z3=0x00;                                                              
 884   7                                       }                               
 885   6                                      }
 886   5                                      if(d3z3>=0x09&&d3z3<=0x12)      //第三片
 887   5                                      {
 888   6                                       if(d3z3==0x09)
 889   6                                       {
 890   7                                       d3z1=0xfd;
 891   7                                       d3z2=d3z4&d3z1;
 892   7                                       d3z4=d3z2;
 893   7                                       d3z3=0x00;
 894   7                                       }        
 895   6                                       if(d3z3==0x10)
 896   6                                       {
 897   7                                       d3z1=0xf7;
 898   7                                       d3z2=d3z4&d3z1;
 899   7                                       d3z4=d3z2;
 900   7                                       d3z3=0x00;                                                              
 901   7                                       }
 902   6                                       if(d3z3==0x11)
 903   6                                       {d3z1=0xdf;
 904   7                                       d3z2=d3z4&d3z1;
 905   7                                       d3z4=d3z2;
 906   7                                       d3z3=0x00;                                                              
 907   7                                       }
 908   6                                       if(d3z3==0x12)
 909   6                                       {d3z1=0x7f;
 910   7                                       d3z2=d3z4&d3z1;
 911   7                                       d3z4=d3z2;
 912   7                                       d3z3=0x00;                                                              
 913   7                                       }                               
 914   6                                      } 
 915   5                      if(d4z3>=0x13&&d4z3<=0x16)       //第四片
 916   5                                      {
 917   6                                       if(d4z3==0x13)
 918   6                                       {
 919   7                                       d4z1=0xfd;
 920   7                                       d4z2=d4z4&d4z1;
 921   7                                       d4z4=d4z2;
 922   7                                       d4z3=0x00;
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 16  

 923   7                                       }        
 924   6                                       if(d4z3==0x14)
 925   6                                       {
 926   7                                       d4z1=0xf7;
 927   7                                       d4z2=d4z4&d4z1;
 928   7                                       d4z4=d4z2;
 929   7                                       d4z3=0x00;                                                              
 930   7                                       }
 931   6                                       if(d4z3==0x15)
 932   6                                       {d4z1=0xdf;
 933   7                                       d4z2=d4z4&d4z1;
 934   7                                       d4z4=d4z2;
 935   7                                       d4z3=0x00;                                                              
 936   7                                       }
 937   6                                       if(d4z3==0x16)
 938   6                                       {d4z1=0x7f;
 939   7                                       d4z2=d4z4&d4z1;
 940   7                                       d4z4=d4z2;
 941   7                                       d4z3=0x00;                                                              
 942   7                                       }                               
 943   6                                      } 
 944   5                                      if(d5z3>=0x17&&d5z3<=0x20)       //第五片
 945   5                                      {
 946   6                                       if(d5z3==0x17)
 947   6                                       {
 948   7                                       d5z1=0xfd;
 949   7                                       d5z2=d5z4&d5z1;
 950   7                                       d5z4=d5z2;
 951   7                                       d5z3=0x00;
 952   7                                       }        
 953   6                                       if(d5z3==0x18)
 954   6                                       {
 955   7                                       d5z1=0xf7;
 956   7                                       d5z2=d5z4&d5z1;
 957   7                                       d5z4=d5z2;
 958   7                                       d5z3=0x00;                                                              
 959   7                                       }
 960   6                                       if(d5z3==0x19)
 961   6                                       {d5z1=0xdf;
 962   7                                       d5z2=d5z4&d5z1;
 963   7                                       d5z4=d5z2;
 964   7                                       d5z3=0x00;                                                              
 965   7                                       }
 966   6                                       if(d5z3==0x20)
 967   6                                       {d5z1=0x7f;
 968   7                                       d5z2=d5z4&d5z1;
 969   7                                       d5z4=d5z2;
 970   7                                       d5z3=0x00;                                                              
 971   7                                       }                               
 972   6                                      } 
 973   5                                      if(d6z3>=0x21&&d6z3<=0x24)       //第六片
 974   5                                      {
 975   6                                       if(d6z3==0x21)
 976   6                                       {
 977   7                                       d6z1=0xfd;
 978   7                                       d6z2=d6z4&d6z1;
 979   7                                       d6z4=d6z2;
 980   7                                       d6z3=0x00;
 981   7                                       }        
 982   6                                       if(d6z3==0x22)
 983   6                                       {
 984   7                                       d6z1=0xf7;
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 17  

 985   7                                       d6z2=d6z4&d6z1;
 986   7                                       d6z4=d6z2;
 987   7                                       d6z3=0x00;                                                              
 988   7                                       }
 989   6                                       if(d6z3==0x23)
 990   6                                       {d6z1=0xdf;
 991   7                                       d6z2=d6z4&d6z1;
 992   7                                       d6z4=d6z2;
 993   7                                       d6z3=0x00;                                                              
 994   7                                       }
 995   6                                       if(d6z3==0x24)
 996   6                                       {d6z1=0x7f;
 997   7                                       d6z2=d6z4&d6z1;
 998   7                                       d6z4=d6z2;
 999   7                                       d6z3=0x00;                                                              
1000   7                                       }                               
1001   6                                      }                                        
1002   5                                       pin1=dz2;
1003   5                                       pin2=d2z2;
1004   5                                       pin3=d3z2; 
1005   5                                       pin4=d4z2;
1006   5                                       pin5=d5z2;
1007   5                                       pin6=d6z2;
1008   5                     if(cmdIndex==0x32)                //
1009   5                                 {
1010   6                                 if(pin1!=0xff)d1=1;
1011   6                                 if(pin2!=0xff)d2=1;
1012   6                                 if(pin3!=0xff)d3=1;
1013   6                                 if(pin4!=0xff)d4=1;
1014   6                                 if(pin5!=0xff)d5=1;
1015   6                                 if(pin6!=0xff)d6=1;
1016   6                                 ST=0;
1017   6                                 break;
1018   6                                 } 
1019   5                                }
1020   4                              }                 
1021   3                  else if(cmdIndex==0x32)     //动点启动
1022   3                  {
1023   4                                if(d1==0)pin1=0xff;
1024   4                                if(d2==0)pin2=0xff;
1025   4                                if(d3==0)pin3=0xff;
1026   4                                if(d4==0)pin4=0xff;
1027   4                                if(d5==0)pin5=0xff;
1028   4                                if(d6==0)pin6=0xff;
1029   4                                ST=1;
1030   4                                clear();
1031   4                                while(1&ST)
1032   4                                 {
1033   5                                  OEd=0;
1034   5                                  ind(pin6);
1035   5                                      ind(pin5);
1036   5                                      ind(pin4);
1037   5                                      ind(pin3);
1038   5                                      ind(pin2);
1039   5                                      ind(pin1);
1040   5                                      outd();
1041   5                                      Delay10ms(30);
1042   5                     sleep();
1043   5                                      pin1=0xff;
1044   5                                      pin2=0xff;
1045   5                                      pin3=0xff;
1046   5                                      pin4=0xff;
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 18  

1047   5                                      pin5=0xff;
1048   5                                      pin6=0xff;
1049   5                                      dz4=0xff;
1050   5                                  d2z4=0xff;
1051   5                                  d3z4=0xff;
1052   5                                      d4z4=0xff;
1053   5                                  d5z4=0xff;
1054   5                                  d6z4=0xff;
1055   5                                      d1=0;
1056   5                                      d2=0;
1057   5                                      d3=0;
1058   5                                      d4=0;
1059   5                                      d5=0;
1060   5                                      d6=0;
1061   5                                      ST=0;
1062   5                                      cmdIndex=0;
1063   5                                  break;
1064   5                                }     
1065   4                              }
1066   3                else if(cmdIndex==0x35)//动点清屏
1067   3                      {
1068   4                                       OEd=0;
1069   4                           ind(0xff);
1070   4                                               ind(0xff);
1071   4                           ind(0xff);
1072   4                           ind(0xff);
1073   4                           ind(0xff);
1074   4                           ind(0xaa);
1075   4                           outd();
1076   4                           Delay10ms(10);
1077   4                                               ind(0xff);
1078   4                                               ind(0xff);
1079   4                           ind(0xff);
1080   4                                               ind(0xff);
1081   4                           ind(0xaa);
1082   4                           ind(0xff);
1083   4                           outd();
1084   4                                               Delay10ms(10);
1085   4                           ind(0xff);
1086   4                                               ind(0xff);
1087   4                           ind(0xff);
1088   4                                               ind(0xaa);
1089   4                           ind(0xff);
1090   4                           ind(0xff);
1091   4                           outd();
1092   4                           Delay10ms(10);
1093   4                                               ind(0xff);
1094   4                                               ind(0xff);
1095   4                           ind(0xaa);
1096   4                                               ind(0xff);
1097   4                           ind(0xff);
1098   4                           ind(0xff);
1099   4                           outd();
1100   4                           Delay10ms(10);
1101   4                                               ind(0xff);
1102   4                                               ind(0xaa);
1103   4                           ind(0xff);
1104   4                                               ind(0xff);
1105   4                           ind(0xff);
1106   4                           ind(0xff);
1107   4                           outd();
1108   4                           Delay10ms(10);
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 19  

1109   4                                               ind(0xaa);
1110   4                                               ind(0xff);
1111   4                           ind(0xff);
1112   4                                               ind(0xff);
1113   4                           ind(0xff);
1114   4                           ind(0xff);
1115   4                           outd();
1116   4                           Delay10ms(10);
1117   4                                               cmdIndex=0;
1118   4                                               sleep();
1119   4               
1120   4                              }                                               
1121   3                              }         
1122   2              } 
1123   1           }                                            
1124          void time0(void) interrupt 1     //定时器中断函数
1125           {
1126   1          TH0=(65536-500)/256;
1127   1              TL0=(65536-500)%256;
1128   1              ++t;
1129   1              ++t2;
1130   1              ++t3;
1131   1          ++t4;
1132   1              ++t5;
1133   1              
1134   1              if(t>20)
1135   1                {
1136   2                t=0;
1137   2                }
1138   1              if(t<=zkb)
1139   1                {
1140   2                 OE=0;
1141   2                }
1142   1              else 
1143   1                {
1144   2                  OE=1;
1145   2                }
1146   1      
1147   1      
1148   1                if(t2>20)
1149   1                {
1150   2                t2=0;
1151   2                }
1152   1      if(t2<=zkb2)
1153   1                {
1154   2                 OE1=0;
1155   2                }
1156   1      else 
1157   1                {
1158   2                  OE1=1;
1159   2                }
1160   1      
1161   1      
1162   1              if(t3>20)
1163   1                {
1164   2                t3=0;
1165   2                }
1166   1              if(t3<=zkb3)
1167   1                {
1168   2                 OE2=0;
1169   2                }
1170   1              else 
C51 COMPILER V9.00   TOGETHER                                                              06/10/2019 15:30:31 PAGE 20  

1171   1                {
1172   2                  OE2=1;
1173   2                }      
1174   1                      
1175   1                      if(t4>20)
1176   1                {
1177   2                t4=0;
1178   2                }
1179   1              if(t4<=zkb4)
1180   1                {
1181   2                 OE31=0;
1182   2                }
1183   1              else 
1184   1                {
1185   2                  OE31=1;
1186   2                }
1187   1      
1188   1      
1189   1              if(t5>20)
1190   1                {
1191   2                t5=0;
1192   2                }
1193   1              if(t5<=zkb5)
1194   1                {
1195   2                 OE32=0;
1196   2                }
1197   1              else 
1198   1                {
1199   2                  OE32=1;
1200   2                }
1201   1        }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2909    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     79    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
