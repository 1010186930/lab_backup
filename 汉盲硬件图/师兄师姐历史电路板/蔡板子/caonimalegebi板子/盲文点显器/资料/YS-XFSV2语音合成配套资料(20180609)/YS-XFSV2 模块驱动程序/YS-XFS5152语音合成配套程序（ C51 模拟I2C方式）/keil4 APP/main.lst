C51 COMPILER V9.00   MAIN                                                                  01/08/2013 09:36:46 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN ..\obj\main.obj
COMPILER INVOKED BY: C:\Program Files\keil 4\C51\BIN\C51.EXE ..\code\main.c BROWSE INCDIR(..\code;..\user) DEBUG OBJECTE
                    -XTEND PRINT(..\..\main.lst) TABS(2) OBJECT(..\obj\main.obj)

line level    source

   1          /***************************飞音云电子****************************
   2          **  工程名称：YS-5051语音合成测试程序
   3          **  CPU: STC89LE52
   4          **  晶振：22.1184MHZ
   5          **  波特率：9600 bit/S
   6          **  配套产品信息：YS-语音识别模块
   7          **                http://yuesheng001.taobao.com
   8          **  作者：zdings
   9          **  联系：751956552@qq.com
  10          **  修改日期：2012.8.25
  11          **  说明：本程序 具备语音合成功能
  12                   用户在使用程序时，只需要编写好 串口发送函数PrintCom()；即可，
  13                   直接调用本文件进行播放即可，在编写程序时，注意判断语音合成模
  14                   块的返回值，根据返回值进行下一次播放，如不接收返回值则无法进
  15                   行下一次播放。
  16          /*****************************飞音云电子*******************************/
  17          
  18          #include "config.h"
  19          
  20          sbit X_REST=P2^0;
  21          
  22          
  23          void delay_10ms(uint16_t N);
  24          void MCU_init(); 
  25          extern void XFS_FrameInfo(uint8_t *HZdata);
  26          uint8_t tim_flag=0; //1:时间到
  27          uint16_t tim_cnt=50; //定时器计数器 (50MS)
  28          extern uint8_t UART_TXTcnt; //串口接收计数器
  29          extern uint8_t UART_Rcnt; //串口接收计数器
  30          extern uint8_t xdata UART_TXTbuf[80];
  31          extern uint8_t Sign_Ture[3];
  32          extern uint8_t Sign_flag;//信号标志，0：接收帧头，1：接收文本
  33          void XFS_Rest(void);
  34          /***********************************************************
  35          * 名    称：  定时器中断函数
  36          * 功    能： 
  37          * 入口参数： 无 
  38          * 出口参数：无
  39          * 说    明：           
  40          **********************************************************/
  41          void tm0_ISR() interrupt 1 using 1
  42          {
  43   1      
  44   1        TL0=T1MS;
  45   1        TH0=T1MS>>8;
  46   1        
  47   1        if(tim_cnt--==0)
  48   1        {
  49   2          tim_cnt=50;      //50ms 后重置接收
  50   2          tim_flag=1;
  51   2          UART_Rcnt=0;//清除接收计数器
  52   2          UART_TXTcnt=0;//清除接收计数器
  53   2          Sign_flag=0;
  54   2          TR0=0;
C51 COMPILER V9.00   MAIN                                                                  01/08/2013 09:36:46 PAGE 2   

  55   2      
  56   2        }
  57   1      
  58   1      }
  59          
  60          /***********************************************************
  61          * 名    称：   定时器配置
  62          * 功    能： 
  63          * 入口参数： 无 
  64          * 出口参数：无
  65          * 说    明：           
  66          **********************************************************/
  67          void  Tim_cfg(void)
  68          {
  69   1        TMOD |=0X01;
  70   1        TL0=T1MS;
  71   1        TH0=T1MS>>8;
  72   1        TR0=0;
  73   1        ET0=1;
  74   1        EA=1;
  75   1      
  76   1      }
  77          /***********************************************************
  78          * 名    称： void  main(void)
  79          * 功    能： 主函数 程序入口
  80          * 入口参数：  
  81          * 出口参数：
  82          * 说    明：           
  83          * 调用方法： 
  84          **********************************************************/ 
  85          void  main(void)
  86          {
  87   1        MCU_init();
  88   1         XFS_FrameInfo("欢迎使用乐声电子语音合成模块，本模块16进制地址为FD，F0，01") ;
  89   1      
  90   1         while(1)
  91   1         {
  92   2          if(tim_flag==1 && Sign_Ture[2]==3 )               
  93   2          { 
  94   3          XFS_Rest();
  95   3            tim_flag=0;
  96   3          Sign_Ture[2]=0;
  97   3            XFS_FrameInfo(UART_TXTbuf) ;  
  98   3          }
  99   2        }// while
 100   1      
 101   1      }
 102          /***********************************************************
 103          * 名    称： void MCU_init()
 104          * 功    能： 单片机初始化
 105          * 入口参数：  
 106          * 出口参数：
 107          * 说    明：           
 108          * 调用方法： 
 109          **********************************************************/ 
 110          void MCU_init()
 111          {
 112   1        P0 = 0xff;
 113   1        P1 = 0xff;
 114   1        P2 = 0xff;
 115   1        P3 = 0xff;
 116   1        Tim_cfg();
C51 COMPILER V9.00   MAIN                                                                  01/08/2013 09:36:46 PAGE 3   

 117   1        UartIni(); /*串口初始化*/
 118   1        XFS_Rest();
 119   1      }
 120          
 121          void XFS_Rest(void)
 122          {
 123   1        X_REST=1;
 124   1        delay_10ms(0xf);
 125   1        X_REST=0;
 126   1        delay_10ms(0xf);
 127   1        X_REST=1;
 128   1          delay_10ms(0xf);
 129   1        X_REST=0;
 130   1        delay_10ms(0xf);
 131   1        X_REST=1;
 132   1        delay_10ms(0x1ff);
 133   1      }
 134          
 135          
 136          void delay_10ms(uint16_t N)
 137          {
 138   1        uint16_t i,j;
 139   1        for(i=0;i<N;i++)
 140   1         for(j=250;j>0;j--);
 141   1      }
 142          
 143          
 144          
 145          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    187    ----
   CONSTANT SIZE    =     59    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
